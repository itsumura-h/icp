---
sidebar_position: 2
---

# カニスターの最適化

Motoko コンパイラは、比較的効率的なコードで小さなバイナリを生成しますが、高度に最適化されたコンパイラではありません。`wasm-opt` などの追加ツールを使用することで、コードのサイズやサイクル使用量をさらに最適化することが可能です。

## `wasm-opt` の使用

`wasm-opt` は汎用の WAM（WebAssembly）最適化ツールで、現在は dfx のバージョン 0.14.0 以降で使用できます。

`wasm-opt` は、プロジェクトの `dfx.json` ファイルにある設定オプションを使ってカニスターの最適化を有効にするために使用できます。例えば次のように設定します：

```json
{
  "canisters": {
    "my_canister": {
      "optimize": "cycles"
    }
  }
}
```

### サイクル使用量の最適化レベル

`"optimize": "cycles"` オプションを使用すると、Motoko カニスターのサイクル使用量が約10％減少するというおおよその見積もりが期待できます。

`"optimize": "cycles"` オプションは、`wasm-opt` パッケージの最適化レベル 3 に対応しているため、推奨されるデフォルト設定です。

サイクル使用量の最適化レベルは以下の通りです：

```
O4
O3 (「cycles」に相当)
O2
O1
O0 (最適化なし)
```

### バイナリサイズの最適化レベル

代わりにバイナリサイズを最適化するには、`"optimize": "size"` オプションを使用します。サイズオプションを使用することで、バイナリサイズをおおよそ16％削減できます。

バイナリサイズの最適化レベルは以下の通りです：

```
Oz (「size」に相当)
Os
```

各最適化は、各カニスターのインターネットコンピュータ専用のメタデータセクションを保持します。

:::info
最適化が進むと、Wasm モジュール内の一部の関数の複雑さが増し、レプリカによって拒否される可能性があることに注意してください。この問題に遭遇した場合は、複雑さ制限を超えないように、より穏やかな最適化レベルを使用することをお勧めします。
:::

カニスターの最適化および `wasm-opt` のベンチマークテストに関する詳細情報は、[このフォーラム投稿](https://forum.dfinity.org/t/canister-optimizer-available-in-dfx-0-14-0/21157)をご覧ください。

<img src="https://github.com/user-attachments/assets/844ca364-4d71-42b3-aaec-4a6c3509ee2e" alt="Logo" width="150" height="150" />
