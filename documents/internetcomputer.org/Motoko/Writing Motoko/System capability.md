---
sidebar_position: 25
---

# システム能力

Motoko の `system` 能力は、敏感なシステム機能へのアクセスを制御し、これらの機能の悪用を防止するために使用されます。これは、開発者が強力なシステムレベルの操作を使用する際、またはアクセスを許可する際に、そのことを明示的に認識できるようにする安全機構として機能します。

具体的には、`system` 能力は次のような敏感な関数を呼び出すために必要です：

1. `ExperimentalCycles.add`：この関数はサイクル管理に使用され、インターネットコンピュータ上で計算リソースを制御するために重要です。

2. `Timer.setTimer`：この関数は将来の計算をスケジュールするために使用され、システムリソースや挙動に大きな影響を与える可能性があります。

`system` 能力の導入により、Motoko の以前のバージョンでは、サードパーティのライブラリ関数がこれらの敏感な関数を呼び出す際に、呼び出し元に通知なしに呼び出すことができていたというセキュリティの懸念に対処しています。これにより、予期しない挙動やリソースの使用が発生する可能性がありました。

`system` 能力を明示的に宣言し渡すことを要求することで、Motoko は開発者がこれらの強力なシステム機能を使用する際、またはその使用を許可する際に完全に認識できるようにしています。これにより、偶発的な誤用を防ぎ、コードの意図を明確にすることで、セキュリティとコードの可読性が向上します。

重要なのは、`system` 能力がこれらの敏感な関数の使用を許可する一方で、すべてのシステムリソースへの無制限なアクセスを自動的に許可するわけではないということです。これは特定のシステム関数の使用を制御し明示化する型レベルのメカニズムであり、包括的な権限システムではありません。

`system` 能力は Motoko バージョン 0.11.0 で導入されました。主な変更点は、`system` 疑似型パラメータと引数の導入です。例えば、`ExperimentalCycles.add` の型は `Nat -> ()` から `<system>Nat -> ()` に変更され、`system` 能力の新しい要件を反映しています。

コードでシステム機能を使用するには、今後はそれが必要な場合に明示的に宣言し、呼び出し先に許可を与える際には `system` 能力を明示的に渡す必要があります。

システム機能を使用する必要がある関数には、`system` 疑似型パラメータを含める必要があります。`system` が指定されている場合、それは関数やクラス宣言の最初のパラメータである必要があります。

例えば：

``` motoko no-repl
func splitCycles<system>() {
  let amount = ExperimentalCycles.balance() / 2;
  ExperimentalCycles.add(amount); // 警告が表示されます
}
```

暗黙的な `system` 能力の使用に関する警告を抑制するためには、呼び出し元で `system` 能力を明示的に渡すことができます：

``` motoko no-repl
func splitCycles<system>() {
  let amount = ExperimentalCycles.balance() / 2;
  ExperimentalCycles.add<system>(amount); // 警告なしで受け入れられます
}
```

システム能力は、次のような特定のコンテキストで使用可能です：

- アクター式やアクタークラスの本体
- 非クエリの共有関数
- 非同期関数、非同期式
- `system` 疑似型パラメータで宣言されたローカル関数やクラス
- `preupgrade` および `postupgrade` システム関数

ただし、クエリメソッド、複合クエリメソッド、またはシステム能力の必要性を宣言していない関数では使用できません。

詳細については、[言語マニュアル](../reference/language-manual#type-arguments)を参照してください。

以前の Motoko バージョンからコードを移行する方法については、この[ガイド](../migration-guides/0.11.0-migration-guide)を参照してください。

<img src="https://github.com/user-attachments/assets/844ca364-4d71-42b3-aaec-4a6c3509ee2e" alt="Logo" width="150" height="150" />
